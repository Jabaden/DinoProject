<html lang="en"> 
<head> 
	<meta charset="UTF-8" />
	<title>DinoProject!</title>
	<script type="text/javascript" src="phaser.js"></script>
        <script type="text/javascript" src="ui.js"></script>
        <script src="player.js"></script>
        
    <style type="text/css">
        body {
            margin: 0;
        }
    </style>
</head>
<body>

    
<script type="text/javascript">
//initializes a game
console.log("hello");
var game = new Phaser.Game(800, 600, Phaser.AUTO, '', { preload: preload, create: create, update: update, render: render });
var circle;
var dinoPlayer;
var fAid;
var playerCircle;
var enemyAlert = false;
var map;
var layer;
function preload() {
    ui.preload(game);
    game.load.image('star', 'assets/star.png');
    game.load.image('firstaid', 'assets/firstaid.png');
    game.load.image('diamond', 'assets/diamond.png');
    game.load.tilemap('map_json', 'assets/test_jungle_40x40_buffer.json', null, Phaser.Tilemap.TILED_JSON);
    game.load.image('testTiles', 'assets/Jungle_04.png');
    
}

function create() {
    // load the testing jungle map:
    map = game.add.tilemap('map_json');
    map.addTilesetImage('Jungle_04', 'testTiles');
    layer = map.createLayer(0);
    //layer.resizeWorld();
    // enumerate collidable tile indeces:
    map.setCollision( [5, 6, 12, 13, 31, 32, 33, 39, 40, 46, 47, 53, 54],
        true, 0, false );
    console.log("collision indeces:" + map.collision);
    game.physics.startSystem(Phaser.Physics.ARCADE);
    fAid = game.add.sprite(100,100, 'firstaid');
    enemyCircle = new Phaser.Circle(game.world.centerX, 100,100);
    playerCircle = new Phaser.Circle(50,50,10);
    dinoPlayer = new player(game, 'star','diamond');
    dinoPlayer.getSprite().width = 25;
    dinoPlayer.getSprite().height = 25;
    game.physics.enable(dinoPlayer, Phaser.Physics.ARCADE);
    game.physics.enable(fAid, Phaser.Physics.ARCADE);
    game.physics.enable(map, Phaser.Physics.ARCADE);
    fAid.body.immovable = true;
    ui.create(game);
    dinoPlayer.anchor.setTo(0.5, 0.5);
    game.physics.enable(uiColl,Phaser.Physics.ARCADE);

 
}

function update() {
   dinoPlayer.update();
   ui.update(game,100,100,100,100,dinoPlayer);
   playerCircle.x = dinoPlayer.getX() + dinoPlayer.getSprite().width/2;
   playerCircle.y = dinoPlayer.getY() + dinoPlayer.getSprite().height/2;
   enemyCircle.x = fAid.x + fAid.width/2;
   enemyCircle.y = fAid.y + fAid.height/2;
   game.physics.arcade.collide(dinoPlayer.getSprite(), fAid , touching, null, this);
   game.physics.arcade.collide(dinoPlayer.getSprite(), uiColl, touching, null, this);
   //console.log(Phaser.Circle.intersects(playerCircle, enemyCircle));
   if(Phaser.Circle.intersects(playerCircle,enemyCircle) == true || enemyAlert == true)
   {
       game.physics.arcade.moveToXY(fAid, dinoPlayer.getX(), dinoPlayer.getY());
       enemyAlert = true;
   }
   
   // check for collisions with map:
   game.physics.arcade.collide(dinoPlayer, layer);
}

function render()
{
    game.debug.geom(enemyCircle,'#cfffff', false);
    game.debug.geom(playerCircle,'#cfffff', false);
    game.debug.bodyInfo(dinoPlayer.getSprite(), 32, 32);
}

function touching(player,other)
{
    console.log("hi there");
    game.stage.backgroundColor = '#992d2d';
}

</script>
</body>
</html>
